@model ASF.Entities.CartItem[]

@{
    ViewBag.Title = "CartItemXCookie";
}

<h2>CartItemXCookie</h2>


@using (Html.BeginForm("FinalizarCompra", "OrderDetail", FormMethod.Post))
{

<table class="table">
    <tr>
        <th>
            
        </th>
        <th>
            Precio
        </th>
        <th>
            Cantidad
        </th>
        <th>
            Descripcion
        </th>
        <th>
            Imagen
        </th>
        @*<th>
                @Html.DisplayNameFor(model => model.ChangedOn)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ChangedBy)
            </th>*@
        <th></th>
    </tr>
    


    @for (var i = 0; i < Model.Length; i++) 
    {
        <tr>
            <td>
                @Html.HiddenFor(modelItem => Model[i].Id)
            </td>

            <td>
                @Html.HiddenFor(modelItem => Model[i].Product.Price)
                @Html.DisplayFor(modelItem => Model[i].Product.Price)
            </td>
            <td>
                @Html.EditorFor(modelItem => Model[i].Quantity)      
              
                
            </td>
            <td>
                @Html.DisplayFor(modelItem => Model[i].Product.Description)
            </td>
            <td>
                <img src="@string.Format("data:image/jpeg;base64,{0}", Convert.ToBase64String(Model[i].Product.Image))" alt="" height=100 width=200/>
            </td>
            @*<td>
                    @Html.DisplayFor(modelItem => item.ChangedOn)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ChangedBy)
                </td>*@
            <td>
                <a href="/CartItem/Eliminar/@Model[i].Id " class="Carrito">Eliminar del Carrito</a>

            </td>
        </tr>

        
      
    }
    
  


  

</table>

<div class="row">

    <div class="col-md-4">

        <input type="submit" class="btn btn-default" value ="Finalizar Compra" />

    </div>


</div>

}

<script>

    $(document).ready(function () {
        $("table a.Carrito").click(function (event) {
            event.preventDefault();
            var link = this;
            var values = link.name;
            if (confirm("Are you sure that you want to delete this user?")) {
                $.ajax({
                    url: link.href,
                    dataType: "json",
                    type: "GET",
                    contentType: 'application/json; charset=utf-8',

                    async: true,
                    cache: false,

                    success: function (data) {
                        alert(data);
                        var url = "/CartItem/CartItemXCookie";
                        window.location.href = url;
                    },
                    error: function (data) {
                        alert("This user cannot be deleted");
                    }
                });
            }
        }
        );




    });


</script>